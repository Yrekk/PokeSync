{\rtf1\ansi\deff0\adeflang1025
{\fonttbl{\f0\froman\fprq2\fcharset0 Times New Roman;}{\f1\froman\fprq2\fcharset2 Symbol;}{\f2\fswiss\fprq2\fcharset0 Arial;}{\f3\fnil\fprq0\fcharset128 OpenSymbol{\*\falt Arial Unicode MS};}{\f4\fmodern\fprq1\fcharset0 Courier New;}{\f5\fnil\fprq2\fcharset0 Microsoft YaHei;}{\f6\fnil\fprq2\fcharset0 SimSun;}{\f7\fmodern\fprq1\fcharset0 NSimSun;}{\f8\fnil\fprq2\fcharset0 Arial;}{\f9\fswiss\fprq0\fcharset128 Arial;}}
{\colortbl;\red0\green0\blue0;\red0\green0\blue128;\red128\green128\blue128;}
{\stylesheet{\s0\snext0\nowidctlpar{\*\hyphen2\hyphlead2\hyphtrail2\hyphmax0}\cf0\hich\af6\langfe2052\dbch\af8\afs24\lang1081\loch\f0\fs24\lang1036 Standard;}
{\s2\sbasedon20\snext21\ilvl1\outlinelevel1\sb240\sa120\keepn\b\hich\af6\dbch\af8\afs36\ab\loch\f0\fs36 Titre 2;}
{\s3\sbasedon20\snext21\ilvl2\outlinelevel2\sb240\sa120\keepn\b\hich\af6\dbch\af8\afs28\ab\loch\f0\fs28 Titre 3;}
{\*\cs15\snext15\b\ab Accentuation forte;}
{\*\cs16\snext16\hich\af3\dbch\af3\loch\f3 Puces;}
{\*\cs17\snext17\hich\af7\dbch\af4\loch\f4 Texte source;}
{\*\cs18\snext18\i\ai Accentuation;}
{\*\cs19\snext19\cf2\ul\ulc0\langfe255\lang255\lang255 Lien Internet;}
{\s20\sbasedon0\snext21\sb240\sa120\keepn\hich\af5\dbch\af8\afs28\loch\f2\fs28 Titre;}
{\s21\sbasedon0\snext21\sb0\sa120 Corps de texte;}
{\s22\sbasedon21\snext22\sb0\sa120\dbch\af9 Liste;}
{\s23\sbasedon0\snext23\sb120\sa120\noline\i\dbch\af9\afs24\ai\fs24 Légende;}
{\s24\sbasedon0\snext24\noline\dbch\af9 Index;}
{\s25\sbasedon0\snext25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20 Texte préformaté;}
}{\*\listtable{\list\listtemplateid1
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li707}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li1414}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2121}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2828}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li3535}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4242}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4949}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li5656}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li6363}\listid1}
{\list\listtemplateid2
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li707}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li1414}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2121}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2828}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li3535}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4242}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4949}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li5656}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li6363}\listid2}
{\list\listtemplateid3
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li707}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li1414}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2121}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2828}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li3535}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4242}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4949}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li5656}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li6363}\listid3}
{\list\listtemplateid4
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li707}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li1414}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2121}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2828}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li3535}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4242}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4949}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li5656}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li6363}\listid4}
{\list\listtemplateid5
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li707}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li1414}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2121}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2828}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li3535}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4242}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4949}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li5656}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li6363}\listid5}
{\list\listtemplateid6
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li707}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li1414}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2121}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2828}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li3535}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4242}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4949}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li5656}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li6363}\listid6}
{\list\listtemplateid7
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li707}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li1414}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2121}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li2828}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li3535}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4242}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li4949}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li5656}
{\listlevel\levelnfc23\leveljc0\levelstartat1\levelfollow0{\leveltext \'01\u8226 ?;}{\levelnumbers;}\f3\dbch\af3\fi-283\li6363}\listid7}
{\list\listtemplateid8
{\listlevel\levelnfc0\leveljc0\levelstartat1\levelfollow0{\leveltext \'00;}{\levelnumbers;}\fi-432\li432}
{\listlevel\levelnfc0\leveljc0\levelstartat1\levelfollow0{\leveltext \'00;}{\levelnumbers;}\fi-576\li576}
{\listlevel\levelnfc0\leveljc0\levelstartat1\levelfollow0{\leveltext \'00;}{\levelnumbers;}\fi-720\li720}
{\listlevel\levelnfc0\leveljc0\levelstartat1\levelfollow0{\leveltext \'00;}{\levelnumbers;}\fi-864\li864}
{\listlevel\levelnfc0\leveljc0\levelstartat1\levelfollow0{\leveltext \'00;}{\levelnumbers;}\fi-1008\li1008}
{\listlevel\levelnfc0\leveljc0\levelstartat1\levelfollow0{\leveltext \'00;}{\levelnumbers;}\fi-1152\li1152}
{\listlevel\levelnfc0\leveljc0\levelstartat1\levelfollow0{\leveltext \'00;}{\levelnumbers;}\fi-1296\li1296}
{\listlevel\levelnfc0\leveljc0\levelstartat1\levelfollow0{\leveltext \'00;}{\levelnumbers;}\fi-1440\li1440}
{\listlevel\levelnfc0\leveljc0\levelstartat1\levelfollow0{\leveltext \'00;}{\levelnumbers;}\fi-1584\li1584}\listid8}
}{\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}{\listoverride\listid2\listoverridecount0\ls2}{\listoverride\listid3\listoverridecount0\ls3}{\listoverride\listid4\listoverridecount0\ls4}{\listoverride\listid5\listoverridecount0\ls5}{\listoverride\listid6\listoverridecount0\ls6}{\listoverride\listid7\listoverridecount0\ls7}{\listoverride\listid8\listoverridecount0\ls8}}{\info{\creatim\yr0\mo0\dy0\hr0\min0}{\revtim\yr0\mo0\dy0\hr0\min0}{\printim\yr0\mo0\dy0\hr0\min0}{\comment OpenOffice}{\vern4150}}\deftab709

{\*\pgdsctbl
{\pgdsc0\pgdscuse195\pgwsxn11906\pghsxn16838\marglsxn1134\margrsxn1134\margtsxn1134\margbsxn1134\pgdscnxt0 Standard;}}
\formshade\paperh16838\paperw11906\margl1134\margr1134\margt1134\margb1134\sectd\sbknone\sectunlocked1\pgndec\pgwsxn11906\pghsxn16838\marglsxn1134\margrsxn1134\margtsxn1134\margbsxn1134\ftnbj\ftnstart1\ftnrstcont\ftnnar\aenddoc\aftnrstcont\aftnstart1\aftnnrlc
\pgndec\pard\plain \s2\ilvl1\outlinelevel1\sb240\sa120\keepn\b\hich\af6\dbch\af8\afs36\ab\loch\f0\fs36\sb240\sa120{\rtlch \ltrch\loch
Qu\'92est-ce qu\'92un Middleware ?}
\par \pard\plain \s21\sb0\sa120{\rtlch \ltrch\loch
Un }{\*\cs15\b\ab\rtlch \ltrch\loch
middleware}{\rtlch \ltrch\loch
 dans ASP.NET Core, c\'92est une }{\*\cs15\b\ab\rtlch \ltrch\loch
composante du pipeline de traitement HTTP}{\rtlch \ltrch\loch
.\line Chaque requ\'eate qui arrive passe \'e0 travers une s\'e9rie de middlewares (cha\'eene), et chacun peut :}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls1 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\*\cs15\b\ab\rtlch \ltrch\loch
agir avant}{\rtlch \ltrch\loch
 que la requ\'eate continue (ex : log, validation, authentification, etc.)}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls1 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\*\cs15\b\ab\rtlch \ltrch\loch
agir apr\'e8s}{\rtlch \ltrch\loch
 la r\'e9ponse (ex : formatter la sortie, g\'e9rer les erreurs, etc.)}
\par \pard\plain \s21\sb0\sa120{\rtlch \ltrch\loch
C\'92est en gros un }{\*\cs15\b\ab\rtlch \ltrch\loch
cha\'eenon d\'92ex\'e9cution}{\rtlch \ltrch\loch
 entre la requ\'eate HTTP brute et ton contr\'f4leur.}
\par \pard\plain \s3\ilvl2\outlinelevel2\sb240\sa120\keepn\b\hich\af6\dbch\af8\afs28\ab\loch\f0\fs28{\rtlch \ltrch\loch
Exemple typique :}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
public class LoggingMiddleware}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
\{}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
private readonly RequestDelegate _next;}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\rtlch \ltrch\loch
}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
public LoggingMiddleware(RequestDelegate next)}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
\{}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
        }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
_next = next;}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
\}}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\rtlch \ltrch\loch
}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
public async Task Invoke(HttpContext context)}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
\{}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
        }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
Console.WriteLine($"\u10145\'3f\u65039\'3f Requ\'eate : \{context.Request.Method\} \{context.Request.Path\}");}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
        }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
await _next(context); // Passe au middleware suivant}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
        }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
Console.WriteLine($"\u11013\'3f\u65039\'3f R\'e9ponse : \{context.Response.StatusCode\}");}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
\}}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\sb0\sa283\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
\}}
\par \pard\plain \s0\nowidctlpar{\*\hyphen2\hyphlead2\hyphtrail2\hyphmax0}\cf0\hich\af6\langfe2052\dbch\af8\afs24\lang1081\loch\f0\fs24\lang1036{\rtlch \ltrch\loch
Chaque middleware appelle }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
_next(context)}{\rtlch \ltrch\loch
 pour passer la main au suivant.\line Si un middleware }{\*\cs15\b\ab\rtlch \ltrch\loch
n\'92appelle pas}{\rtlch \ltrch\loch
 }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
_next}{\rtlch \ltrch\loch
, il }{\*\cs15\b\ab\rtlch \ltrch\loch
interrompt la cha\'eene}{\rtlch \ltrch\loch
, et la r\'e9ponse part directement. \line \line Le r\'f4le particulier de }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
Invoke}
\par \pard\plain \s21\sb0\sa120{\rtlch \ltrch\loch
Dans les middlewares personnalis\'e9s, }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
Invoke}{\*\cs15\b\ab\rtlch \ltrch\loch
 (ou }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
InvokeAsync}{\*\cs15\b\ab\rtlch \ltrch\loch
)}{\rtlch \ltrch\loch
 est le c\'9cur du traitement :}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls2 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\rtlch \ltrch\loch
Elle re\'e7oit le }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
HttpContext}{\rtlch \ltrch\loch
 (toute la requ\'eate + r\'e9ponse).}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls2 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\rtlch \ltrch\loch
Elle peut intercepter, modifier, court-circuiter, ou laisser passer.}
\par \pard\plain \s21\sb0\sa120{\rtlch \ltrch\loch
Le runtime ASP.NET Core }{\*\cs15\b\ab\rtlch \ltrch\loch
appelle automatiquement cette m\'e9thode}{\rtlch \ltrch\loch
 quand la requ\'eate passe dans ton middleware.\line C\'92est pour \'e7a qu\'92il suffit qu\'92elle soit publique et s\'92appelle }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
Invoke}{\rtlch \ltrch\loch
 (ou }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
InvokeAsync}{\rtlch \ltrch\loch
) pour \'eatre reconnue.}
\par \pard\plain \s21\sb0\sa120{\*\cs15\b\ab\rtlch \ltrch\loch
Comment marche }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
UpsertAsync}{\*\cs15\b\ab\rtlch \ltrch\loch
 \line \line 1) L\'92API normalise puis appelle l\'92Upsert}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls3 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\*\cs15\b\ab\rtlch \ltrch\loch
Types}{\rtlch \ltrch\loch
 : on }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
trim + lower}{\rtlch \ltrch\loch
 les noms pour \'e9viter les doublons \'93Feu\'94 vs \'93feu\'94.\line Appel :}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
_upsert.UpsertAsync<ElementType, TypeDto, string>(}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
normalized,}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
e => e.Name,         // cl\'e9 c\'f4t\'e9 entit\'e9}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
d => d.Name,         // cl\'e9 c\'f4t\'e9 DTO}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
d => new ElementType \{ Name = d.Name \},}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
StringComparer.OrdinalIgnoreCase,}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
ct}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\sb0\sa283\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
)}
\par \pard\plain \s21\sb0\sa120{\*\cs15\b\ab\rtlch \ltrch\loch
Generations : on valide }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
Number>0}{\*\cs15\b\ab\rtlch \ltrch\loch
, }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
Name}{\*\cs15\b\ab\rtlch \ltrch\loch
 non vide.\line Appel :}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
_upsert.UpsertAsync<Generation, GenerationDto, int>(}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
valid,}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
e => e.Number,       // cl\'e9 c\'f4t\'e9 entit\'e9}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
d => d.Number,       // cl\'e9 c\'f4t\'e9 DTO}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
d => new Generation \{ Number = d.Number, Name = d.Name \},}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
EqualityComparer<int>.Default,}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch
    }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
ct}
\par \pard\plain \s25\sb0\sa0\hich\af7\dbch\af4\afs20\loch\f4\fs20\li707\ri0\lin707\rin0\fi0\sb0\sa283\ltrpar{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
)}
\par \pard\plain \s21\sb0\sa120{\rtlch \ltrch\loch
? Ici, }{\*\cs15\b\ab\rtlch \ltrch\loch
la cl\'e9 unique n\'92est pas composite}{\rtlch \ltrch\loch
 :}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls5 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
Type}{\rtlch \ltrch\loch
 = }{\*\cs15\b\ab\rtlch \ltrch\loch
Name}{\rtlch \ltrch\loch
 (insensible \'e0 la casse),}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls5 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
Generation}{\rtlch \ltrch\loch
 = }{\*\cs15\b\ab\rtlch \ltrch\loch
Number}{\rtlch \ltrch\loch
 (et pas }{\*\cs18\i\ai\rtlch \ltrch\loch
Number+Name}{\rtlch \ltrch\loch
).\line C\'92est ce que montrent les lambdas pass\'e9es \'e0 }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
UpsertAsync}{\rtlch \ltrch\loch
 (s\'e9lecteurs de cl\'e9). }{{\field{\*\fldinst HYPERLINK "https://github.com/Yrekk/PokeSync/commit/21b3ef679f89807b72f24f407ca572693534c838" \\t "_blank" }{\fldrslt \cf2\ul\ulc0\langfe255\lang255\lang255\rtlch \ltrch\loch
GitHub}}}
\par \pard\plain \s3\ilvl2\outlinelevel2\sb240\sa120\keepn\b\hich\af6\dbch\af8\afs28\ab\loch\f0\fs28{\rtlch \ltrch\loch
2) \'c0 partir de }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
TEntity}{\rtlch \ltrch\loch
, EF sait \'93quelle table taper\'94}
\par \pard\plain \s21\sb0\sa120{\rtlch \ltrch\loch
Dans }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
UpsertAsync}{\rtlch \ltrch\loch
, on r\'e9cup\'e8re }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
DbSet<TEntity>}{\rtlch \ltrch\loch
 via }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
db.Set<TEntity>()}{\rtlch \ltrch\loch
. Comme }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
TEntity}{\rtlch \ltrch\loch
 est mapp\'e9e par EF Core, }{\*\cs15\b\ab\rtlch \ltrch\loch
EF sait d\'e9j\'e0 \'e0 quelle table correspondre}{\rtlch \ltrch\loch
 (config + conventions). Pas besoin d\'92\'e9crire une requ\'eate SQL ni de \'93mapper \'e0 la main\'94 : c\'92est l\'92ORM qui g\'e8re.}
\par \pard\plain \s3\ilvl2\outlinelevel2\sb240\sa120\keepn\b\hich\af6\dbch\af8\afs28\ab\loch\f0\fs28{\rtlch \ltrch\loch
3) R\'e9cup\'e9ration en }{\*\cs15\b\ab\rtlch \ltrch\loch
un seul aller}{\rtlch \ltrch\loch
 des cl\'e9s existantes}
\par \pard\plain \s21\sb0\sa120{\rtlch \ltrch\loch
L\'92impl\'e9 typique fait :}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls6 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
var existingKeys = await db.Set<TEntity>().Select(entityKeySelector).ToListAsync(ct);}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls6 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\rtlch \ltrch\loch
On met \'e7a dans un }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
HashSet<TKey>}{\rtlch \ltrch\loch
 avec le }{\*\cs15\b\ab\rtlch \ltrch\loch
comparer}{\rtlch \ltrch\loch
 fourni (par ex. }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
StringComparer.OrdinalIgnoreCase}{\rtlch \ltrch\loch
).\line \u8594\'3f \'c7a permet de savoir }{\*\cs15\b\ab\rtlch \ltrch\loch
d\'92un coup d\'92\'9cil}{\rtlch \ltrch\loch
 si une cl\'e9 existe d\'e9j\'e0, sans plusieurs allers-retours.}
\par \pard\plain \s3\ilvl2\outlinelevel2\sb240\sa120\keepn\b\hich\af6\dbch\af8\afs28\ab\loch\f0\fs28{\rtlch \ltrch\loch
4) D\'e9tection des \'93vraies nouveaut\'e9s\'94 dans le payload}
\par \pard\plain \s21\sb0\sa120{\rtlch \ltrch\loch
Pour chaque DTO du payload :}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls7 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\rtlch \ltrch\loch
On calcule la cl\'e9 via }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
dtoKeySelector(dto)}{\rtlch \ltrch\loch
.}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls7 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\rtlch \ltrch\loch
Si la cl\'e9 est }{\*\cs15\b\ab\rtlch \ltrch\loch
d\'e9j\'e0}{\rtlch \ltrch\loch
 dans le HashSet \u8594\'3f }{\*\cs15\b\ab\rtlch \ltrch\loch
skip++}{\rtlch \ltrch\loch
 (rien \'e0 faire).}
\par \pard\plain \s21\sb0\sa120{\listtext\pard\plain \hich\af3\dbch\af3\loch\f3 \'95\tab}\ilvl0\ls7 \li0\ri0\lin0\rin0\fi-283\tx707\li707\ri0\lin707\rin0\fi-283{\rtlch \ltrch\loch
Sinon \u8594\'3f on cr\'e9e l\'92entit\'e9 via le }{\*\cs15\b\ab\rtlch \ltrch\loch
factory}{\rtlch \ltrch\loch
 (}{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
dto => new TEntity \{ ... \}}{\rtlch \ltrch\loch
), on l\'92}{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
Add}{\rtlch \ltrch\loch
 dans le DbSet, et }{\*\cs15\b\ab\rtlch \ltrch\loch
inserted++}{\rtlch \ltrch\loch
.}
\par \pard\plain \s3\ilvl2\outlinelevel2\sb240\sa120\keepn\b\hich\af6\dbch\af8\afs28\ab\loch\f0\fs28{\rtlch \ltrch\loch
5) Persist}
\par \pard\plain \s21\sb0\sa120{\rtlch \ltrch\loch
Un }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
await db.SaveChangesAsync(ct)}{\rtlch \ltrch\loch
 final fait l\'92INSERT }{\*\cs15\b\ab\rtlch \ltrch\loch
par lot}{\rtlch \ltrch\loch
 (laissez EF batcher selon la conf), et on }{\*\cs15\b\ab\rtlch \ltrch\loch
retourne }{\*\cs17\hich\af7\dbch\af4\loch\f4\rtlch \ltrch\loch
(inserted, skipped)}{\rtlch \ltrch\loch
 pour le logging/r\'e9sultat.}
\par \pard\plain \s21\sb0\sa120\sb0\sa120{\rtlch \ltrch\loch
}
\par }